{% extends 'base.html'%}

{% block title%}
Flasky
{% endblock%}

{% block body %}
<div class="row">
    <div class=" col-lg-4 col-lg-offset-2 ">
        <div style="width:250px;height:250px;">
        {% if user.userimg_url %}
        <img src="{{url_for('static',filename='image/userimg/')}}{{user.userimg_url}}" alt="" width="250" height="250">
        {% else %}
        <img src="{{user.gravatar(size=220)}}" alt="userImg"class="img-rounded profile-thumbnail">
        {% endif %}
        </div>
            <div>
            {% if current_user.is_administrator or user==current_user %}
            <a href="javascript:void(0)" data-toggle="modal" data-target="#userModal"style="margin-left:100px;">修改头像</a>
            {% endif %}
             <div class="modal fade" id="userModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
                  <div class="modal-dialog" role="document">
                    <div class="modal-content">
                      <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="myModalLabel">自定义头像</h4>
                      </div>
                      <div class="modal-body">
                          <div class="row">
                          <form action="{{url_for('main.handle_userimg',username=user.username)}}" method="post" enctype="multipart/form-data" style="margin-left:20px;">
                              <input type="file" name="file" >
                              <input type="submit" class="btn btn-primary" style="margin-top:20px;float:right;margin-right:20px;">
                          </form>
                          </div>
                      </div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>

                      </div>
                    </div>
                  </div>
                </div>
            </div>
    </div>
    <div class="col-lg-4">
        <h1>{{user.username}}</h1>
        {% if user.name or user.location%}
        <p>
            {% if user.name %}
            {{user.name}}
            {%endif%}
            {% if user.location %}
            From <a href="http://maps.baidu.com/?q={{user.location}}">
            {{user.location }}
        </a>
            {% endif%}
        </p>
        {% endif%}
        {% if current_user.is_administrator() %}
        <p><a href="mailto:{{user.email}}">{{user.email}}</a></p>
        {%endif%}
        {% if user.about_me%}
        <p>{{user.about_me}}</p>
        {% endif%}
        <p>
            Menber since {{moment(user.merber_since).format('L')}}.
            Last seen {{moment(user.last_seen).fromNow()}}
        </p>
        <div class="row">
    {% if current_user.can(Permission.FOLLOW) and current_user !=user%}
    {% if not current_user.is_following(user)%}
    <a href="{{url_for('main.follow',username=user.username)}}" class="btn btn-primary">
        Follow
    </a>
    {% else%}
    <a href="{{url_for('main.unfollow',username=user.username)}}" class="btn btn-primary">Unfollow</a>
    {% endif %}
    {% endif %}
    <a href="{{url_for('main.followers',username=user.username)}}">
        Followers:<span class="badge">{{user.followers.count()}}</span>
    </a>
    <a href="{{url_for('main.followed_by',username=user.username)}}">
        Following:<span class="badge">{{user.followed.count()}}</span>
    </a>
    {% if current_user.is_authenticated and user !=current_user and user.is_following(current_user)%}
    |<span class="label label-default">Follows you</span>
    {% endif %}

             {% if current_user.is_administrator()%}
    <a href="{{url_for('main.edit_profile_admin',id=user.id)}}" class="btn btn-danger">
        Edit Profile [Admin]
    </a>

        {% else %}
        {% if user==current_user %}
        <a href="{{url_for('main.edit_profile')}}" class="btn btn-default">
            Edit Profile
        </a>
        {%endif%}
        {%endif%}
</div>

    </div>

</div>
<div class="row">
    <h3>Posts by {{user.username}}</h3>
    <hr>
    {% include '_post.html'%}
</div>


{% endblock%}


{%block footer%}

{% import 'macro.html' as s %}
{{ s.render_pagination(posts,'main.user', username=user.username)}}
        {{moment.include_moment()}}
    </div>
</div>

{%endblock%}